<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="zend-diactoros: PSR-7 HTTP message implementation">  
    <link rel="shortcut icon" href="../img/favicon.ico">

    <title>Usage - zend-diactoros</title>

    <link rel="stylesheet" href="../css/styles-e3f3751b65.css">
</head>
<body id="page-top">

    
    <div class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">

            
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            
            <span class="navbar-brand">
                <a class="logo-link" href="https://framework.zend.com/" data-tooltip data-placement="bottom" title="Go to the ZF homepage">
                    <img src="../img/zend-framework-logo.svg" height="28" alt="Zend Framework">
                </a>
            </span>
        </div>

        <div class="navbar-collapse collapse">

            
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="https://framework.zend.com/about">About</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/downloads">Install</a>
                </li>
                <li class="active">
                    <a href="https://docs.zendframework.com">Documentation</a>
                </li>
                <li>
                    <a href="https://www.zend.com/en/services/training">Training</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/blog">Blog</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/participate">Participate</a>
                </li>
            </ul>

            
            
                <div class="nav navbar-nav navbar-collapse visible-xs-block ">
                    <div class="subnavigation hidden-print">
    <h4 class="subnavigation__title">
        <a href="..">zend-diactoros</a>
    </h4>

    <h5 class="subnavigation__subtitle">Table of Contents</h5>

    <ul class="subnavigation__list">
        
            
                <li class="subnavigation__list-item ">
                    <a href=".." class="subnavigation__link">zend-diactoros</a>
                </li>
            
        
            
                <li class="subnavigation__list-item ">
                    <a href="../overview/" class="subnavigation__link">Overview</a>
                </li>
            
        
            
                <li class="subnavigation__list-item ">
                    <a href="../install/" class="subnavigation__link">Installation</a>
                </li>
            
        
            
                <li class="subnavigation__list-item subnavigation__list-item--active">
                    <a href="./" class="subnavigation__link">Usage</a>
                </li>
            
        
            
                <li class="subnavigation__list-item">
                    <span class="subnavigation__headline">Reference</span>
                    <ul class="subnavigation__list">
                        
                            
    <li class="subnavigation__list-item ">
        <a href="../custom-responses/" class="subnavigation__link">Custom Responses</a>
    </li>

                        
                            
    <li class="subnavigation__list-item ">
        <a href="../emitting-responses/" class="subnavigation__link">Emitting Responses</a>
    </li>

                        
                            
    <li class="subnavigation__list-item ">
        <a href="../serialization/" class="subnavigation__link">Serialization</a>
    </li>

                        
                            
    <li class="subnavigation__list-item ">
        <a href="../api/" class="subnavigation__link">API</a>
    </li>

                        
                    </ul>
                </li>
            
        
    </ul>
</div>
                </div>
            

            
            <div class="nav navbar-nav navbar-collapse visible-xs-block">
                <div class="component-selector">
    <h4 class="component-selector__title">Components</h4>
    <h5 class="component-selector__subtitle">Find documentation…</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
            </div>
        </div>
    </div>
</div>

    
    <header class="header">
    <div class="container">
        <div class="row">

            
            <div class="col-xs-8">
                <h1 class="header__title">
                    Documentation

                    
                        <small class="header__subtitle">zend-diactoros</small>
                    
                </h1>
            </div>

            
            <div class="col-xs-4 text-right">
                
                    <a href="#" class="header__link header__link--search" data-toggle="modal" data-target="#mkdocs_search_modal" title="Open search">
                        <i class="fa fa-search"></i> Search
                    </a>
                    <a href="https://github.com/zendframework/zend-diactoros/" class="header__link header__link--github" title="Go to repository of zend-diactoros">
                        <i class="fa fa-github"></i> GitHub
                    </a>
                
            </div>
        </div>
    </div>
</header>

    
    <div class="container">
        <div class="row">
            <div class="col-md-9 col-xs-12 content" role="main">
            <!-- content:begin -->
                
                    <ol class="breadcrumb" role="navigation" aria-label="breadcrumbs navigation">
  <li><a href="https://framework.zend.com/">Home</a></li>
  <li><a href="https://docs.zendframework.com/">Docs</a></li>
  <li><a href="..">zend-diactoros</a></li>
  
    
  
  <li class="active">Usage</li>
</ol>


    
    

    
    
        <div class="toc">
            <h6 class="toc__headline">In This Article</h6>
            <ul class="toc__list">
                
                    <li class="toc__entry">
                        <a href="#http-clients" class="toc__link">HTTP Clients</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#server-side-applications" class="toc__link">Server-Side Applications</a>
                    </li>
                
            </ul>
        </div>
    


    <h1 id="usage">Usage</h1>
<p>Usage will differ based on whether you are writing an HTTP client, or a server-side application.</p>
<p>For HTTP client purposes, you will create and populate a <code>Request</code> instance, and the client should
return a <code>Response</code> instance.</p>
<p>For server-side applications, you will create a <code>ServerRequest</code> instance, and populate and return a
<code>Response</code> instance.</p>
<h2 id="http-clients">HTTP Clients</h2>
<p>A client will <em>send</em> a request, and <em>return</em> a response. As a developer, you will <em>create</em> and
<em>populate</em> the request, and then <em>introspect</em> the response.  Both requests and responses are
immutable; if you make changes &mdash; e.g., by calling setter methods &mdash; you must capture the return
value, as it is a new instance.</p>
<pre class="codehilite"><code class="language-php">// Create a request
$request = (new Zend\Diactoros\Request())
    -&gt;withUri(new Zend\Diactoros\Uri('http://example.com'))
    -&gt;withMethod('PATCH')
    -&gt;withAddedHeader('Authorization', 'Bearer ' . $token)
    -&gt;withAddedHeader('Content-Type', 'application/json');

// OR:
$request = new Zend\Diactoros\Request(
    'http://example.com',
    'PATCH',
    'php://memory',
    [
        'Authorization' =&gt; 'Bearer ' . $token,
        'Content-Type'  =&gt; 'application/json',
    ]
);

// If you want to set a non-origin-form request target, set the
// request-target explicitly:
$request = $request-&gt;withRequestTarget((string) $uri);       // absolute-form
$request = $request-&gt;withRequestTarget($uri-&gt;getAuthority()); // authority-form
$request = $request-&gt;withRequestTarget('*');                 // asterisk-form

// Once you have the instance:
$request-&gt;getBody()-&gt;write(json_encode($data));
$response = $client-&gt;send($request);

printf(&quot;Response status: %d (%s)\n&quot;, $response-&gt;getStatusCode(), $response-&gt;getReasonPhrase());
printf(&quot;Headers:\n&quot;);
foreach ($response-&gt;getHeaders() as $header =&gt; $values) {
    printf(&quot;    %s: %s\n&quot;, $header, implode(', ', $values));
}
printf(&quot;Message:\n%s\n&quot;, $response-&gt;getBody());</code></pre>

<p>(Note: <code>zend-diactoros</code> does NOT ship with a client implementation; the above is just an
illustration of a possible implementation.)</p>
<h2 id="server-side-applications">Server-Side Applications</h2>
<p>Server-side applications will need to marshal the incoming request based on superglobals, and will
then populate and send a response.</p>
<h3 id="marshaling-an-incoming-request">Marshaling an incoming request</h3>
<p>PHP contains a plethora of information about the incoming request, and keeps that information in a
variety of locations. <code>Zend\Diactoros\ServerRequestFactory::fromGlobals()</code> can simplify marshaling
that information into a request instance.</p>
<p>You can call the factory method with or without the following arguments, in the following order:</p>
<ul>
<li><code>$server</code>, typically <code>$_SERVER</code></li>
<li><code>$query</code>, typically <code>$_GET</code></li>
<li><code>$body</code>, typically <code>$_POST</code></li>
<li><code>$cookies</code>, typically <code>$_COOKIE</code></li>
<li><code>$files</code>, typically <code>$_FILES</code></li>
</ul>
<p>The method will then return a <code>Zend\Diactoros\ServerRequest</code> instance. If any argument is omitted,
the associated superglobal will be used.</p>
<pre class="codehilite"><code class="language-php">$request = Zend\Diactoros\ServerRequestFactory::fromGlobals(
    $_SERVER,
    $_GET,
    $_POST,
    $_COOKIE,
    $_FILES
);</code></pre>

<p>When no cookie array is supplied, <code>fromGlobals</code> will first try to parse the supplied <code>cookie</code> header
before falling back to the <code>$_COOKIE</code> superglobal. This is done because PHP has some legacy handling
for request parameters which were then registered as global variables. Due to this, cookies with a period
in the name were renamed with underlines. By getting the cookies directly from the cookie header, you have
access to the original cookies in the way you set them in your application and they are send by the user
agent.</p>
<h3 id="manipulating-the-response">Manipulating the response</h3>
<p>Use the response object to add headers and provide content for the response.  Writing to the body
does not create a state change in the response, so it can be done without capturing the return
value. Manipulating headers does, however.</p>
<pre class="codehilite"><code class="language-php">$response = new Zend\Diactoros\Response();

// Write to the response body:
$response-&gt;getBody()-&gt;write(&quot;some content\n&quot;);

// Multiple calls to write() append:
$response-&gt;getBody()-&gt;write(&quot;more content\n&quot;); // now &quot;some content\nmore content\n&quot;

// Add headers
// Note: headers do not need to be added before data is written to the body!
$response = $response
    -&gt;withHeader('Content-Type', 'text/plain')
    -&gt;withAddedHeader('X-Show-Something', 'something');</code></pre>

<h3 id="serving-an-application">"Serving" an application</h3>
<p><code>Zend\Diactoros\Server</code> mimics a portion of the API of node's <code>http.Server</code> class. It invokes a
callback, passing it an <code>ServerRequest</code>, an <code>Response</code>, and optionally a callback to use for
incomplete/unhandled requests.</p>
<p>You can create a server in one of three ways:</p>
<pre class="codehilite"><code class="language-php">// Direct instantiation, with a callback handler, request, and response
$server = new Zend\Diactoros\Server(
    function ($request, $response, $done) {
        $response-&gt;getBody()-&gt;write(&quot;Hello world!&quot;);
    },
    $request,
    $response
);

// Using the createServer factory, providing it with the various superglobals:
$server = Zend\Diactoros\Server::createServer(
    function ($request, $response, $done) {
        $response-&gt;getBody()-&gt;write(&quot;Hello world!&quot;);
    },
    $_SERVER,
    $_GET,
    $_POST,
    $_COOKIE,
    $_FILES
);

// Using the createServerFromRequest factory, and providing it a request:
$server = Zend\Diactoros\Server::createServerFromRequest(
  function ($request, $response, $done) {
      $response-&gt;getBody()-&gt;write(&quot;Hello world!&quot;);
  },
  $request
);</code></pre>

<p>Server callbacks can expect up to three arguments, in the following order:</p>
<ul>
<li><code>$request</code> - the request object</li>
<li><code>$response</code> - the response object</li>
<li><code>$done</code> - an optional callback to call when complete</li>
</ul>
<p>Once you have your server instance, you must instruct it to listen:</p>
<pre class="codehilite"><code class="language-php">$server-&gt;listen();</code></pre>

<p>At this time, you can optionally provide a callback to <code>listen()</code>; this will be passed to the
handler as the third argument (<code>$done</code>):</p>
<pre class="codehilite"><code class="language-php">$server-&gt;listen(function ($request, $response, $error = null) {
    if (! $error) {
        return;
    }
    // do something with the error...
});</code></pre>

<p>Typically, the <code>listen</code> callback will be an error handler, and can expect to receive the request,
response, and error as its arguments (though the error may be null).</p>



    <nav>
    <ul class="page-nav hidden-print">

        
        <li class="page-nav__item">
            
                <a rel="prev" class="page-nav__link page-nav__link--prev" href="../install/">
                    <i class="fa fa-chevron-left"></i> Previous
                </a>
            
        </li>

        
        <li class="page-nav__item">
            
                <a rel="next" class="page-nav__link page-nav__link--next" href="../custom-responses/">
                    Next <i class="fa fa-chevron-right"></i>
                </a>
            
        </li>
    </ul>
</nav>


<div class="help-wanted">
    <p>
        Found a mistake or want to contribute to the documentation?
        <a href="https://github.com/zendframework/zend-diactoros/edit/master/doc/book/usage.md" target="_blank" class="help-wanted__link">
            Edit this page on GitHub!
        </a>
    </p>
</div>
                
            <!-- content:end -->
            </div>
            <div class="col-md-3 col-xs-12 sidebar">
                
                    <div class="component-selector">
    <h4 class="component-selector__title">Components</h4>
    <h5 class="component-selector__subtitle">Find documentation…</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
                    <div class="subnavigation hidden-print">
    <h4 class="subnavigation__title">
        <a href="..">zend-diactoros</a>
    </h4>

    <h5 class="subnavigation__subtitle">Table of Contents</h5>

    <ul class="subnavigation__list">
        
            
                <li class="subnavigation__list-item ">
                    <a href=".." class="subnavigation__link">zend-diactoros</a>
                </li>
            
        
            
                <li class="subnavigation__list-item ">
                    <a href="../overview/" class="subnavigation__link">Overview</a>
                </li>
            
        
            
                <li class="subnavigation__list-item ">
                    <a href="../install/" class="subnavigation__link">Installation</a>
                </li>
            
        
            
                <li class="subnavigation__list-item subnavigation__list-item--active">
                    <a href="./" class="subnavigation__link">Usage</a>
                </li>
            
        
            
                <li class="subnavigation__list-item">
                    <span class="subnavigation__headline">Reference</span>
                    <ul class="subnavigation__list">
                        
                            
    <li class="subnavigation__list-item ">
        <a href="../custom-responses/" class="subnavigation__link">Custom Responses</a>
    </li>

                        
                            
    <li class="subnavigation__list-item ">
        <a href="../emitting-responses/" class="subnavigation__link">Emitting Responses</a>
    </li>

                        
                            
    <li class="subnavigation__list-item ">
        <a href="../serialization/" class="subnavigation__link">Serialization</a>
    </li>

                        
                            
    <li class="subnavigation__list-item ">
        <a href="../api/" class="subnavigation__link">API</a>
    </li>

                        
                    </ul>
                </li>
            
        
    </ul>
</div>
                
            </div>
        </div>
    </div>

    
    <footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-9">
                <h5>Zend Framework</h5>
                <ul>
                    <li><a href="https://framework.zend.com/">framework.zend.com</a></li>
                    <li><a href="https://docs.zendframework.com">docs.zendframework.com</a></li>
                    <li><a href="https://packages.zendframework.com">packages.zendframework.com</a></li>
                    <li><a href="https://apigility.org">apigility.org</a></li>
                    <li><a href="https://getexpressive.org/">getexpressive.org</a></li>
                </ul>
            </div>
        </div>

        
        <div class="row">
            <div class="col-md-12 text-center">
                <a class="footer__button" href="#page-top"><i class="fa fa-chevron-up" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="row">

            
            <div class="col-md-9">
                <h4 class="footer__headline">Copyright</h4>
                <p>&copy; 2006-2018 by <a href="https://www.zend.com/">Zend</a>, a <a href="https://www.roguewave.com/">Rogue Wave Company</a>.</p>
            </div>

            
            <div class="col-md-3">
                <h4 class="footer__headline">Support</h4>
                <ul class="support__list">
                    <li class="support__list-item">
                        <a href="https://discourse.zendframework.com" class="support__link" title="Forum"><i class="fa fa-comments"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://zendframework-slack.herokuapp.com" class="support__link" title="Chat"><i class="fa fa-slack"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://github.com/zendframework" class="support__link" title="Github"><i class="fa fa-github"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://twitter.com/zfdevteam" class="support__link" title="Twitter"><i class="fa fa-twitter"></i></a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>

    <script>
        var base_url = '..',
            siteName = 'zend-diactoros';
    </script>
    <script src="../js/scripts-dcbafde59f.js"></script>
        <script src="../search/require.js"></script>
        <script src="../search/search.js"></script>

    
    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>



</body>


</html>
